# Hearth Accessibility (A11Y) Documentation

## WCAG 2.1.1 Keyboard Navigation Implementation

This document describes the keyboard navigation implementation for Hearth to ensure WCAG 2.1.1 compliance.

### Global Focus Styles

All interactive elements have visible focus indicators:
- **Default focus ring**: 2px hearth-500 (orange) ring with offset
- **Form inputs**: 2px hearth-500 ring without offset
- **Inset focus**: For items within containers, uses inset ring

Focus indicators use `focus-visible` to only show on keyboard navigation, not mouse clicks.

### Skip Links

Two skip links are available at the top of the page:
1. **Skip to main content** - Jumps to the message area
2. **Skip to message input** - Jumps directly to the message composer

### Keyboard Navigation by Component

#### Server Sidebar (ServerList/Sidebar)
- **Tab**: Enter server list
- **Arrow Up/Down**: Navigate between servers
- **Enter/Space**: Select server
- **Home**: Jump to first server (DMs)
- **End**: Jump to last server

#### Channel List
- **Tab**: Enter channel list
- **Arrow Up/Down**: Navigate between channels
- **Enter/Space**: Select channel
- **Home/End**: Jump to first/last channel

#### Message Input
- **Tab**: Focus message input
- **Enter**: Send message
- **Shift+Enter**: New line
- **Escape**: Clear reply preview

#### Context Menus
- **Arrow Up/Down**: Navigate menu items
- **Enter/Space**: Select item
- **Escape**: Close menu
- **Home/End**: Jump to first/last item

#### Emoji Picker
- **Tab**: Enter emoji picker
- **Arrow keys**: Navigate emoji grid (9 columns)
- **Enter/Space**: Select emoji
- **Escape**: Close picker
- **Home/End**: Jump to first/last emoji

#### Search Results
- **Arrow Up/Down**: Navigate results (from search input)
- **Enter**: Select focused result or search
- **Escape**: Close search panel

#### User Settings Modal
- **Escape**: Close settings
- **Arrow Up/Down**: Navigate sidebar sections
- **Tab**: Move through form fields

#### All Modals
- **Escape**: Close modal
- **Tab/Shift+Tab**: Cycle through focusable elements (focus trap)
- Focus automatically moves to first focusable element on open
- Focus returns to trigger element on close

### Utility Functions

The `$lib/utils/keyboard.ts` module provides:

1. **handleListKeyboard()** - Handles arrow key navigation for lists
2. **rovingTabindex()** - Svelte action for roving tabindex pattern
3. **focusTrap()** - Svelte action for modal focus trapping
4. **typeAhead()** - Type-ahead search for lists
5. **announce()** - Screen reader announcements

### ARIA Attributes

Components use appropriate ARIA attributes:
- `role="menu"`, `role="menuitem"` for context menus
- `role="dialog"`, `aria-modal="true"` for modals
- `role="tablist"`, `role="tab"` for tab interfaces
- `role="listbox"`, `role="option"` for selectable lists
- `aria-label` for icon-only buttons
- `aria-expanded`, `aria-haspopup` for expandable controls
- `aria-current="page"` for active navigation items
- `aria-live` regions for dynamic content

### Reduced Motion

Users who prefer reduced motion (via `prefers-reduced-motion: reduce`) will have:
- Minimal animation durations (0.01ms)
- No scroll behavior animations

### Testing Checklist

- [ ] All interactive elements reachable via Tab
- [ ] Logical tab order (left-to-right, top-to-bottom)
- [ ] Visible focus indicators on all focusable elements
- [ ] Arrow key navigation in lists and menus
- [ ] Escape closes modals and popups
- [ ] Focus trapped in modals
- [ ] Focus restored after modal close
- [ ] Skip links functional
- [ ] Screen reader announces dynamic content

### Components with Special Keyboard Handling

| Component | Special Keys |
|-----------|--------------|
| ContextMenu | Arrow Up/Down, Enter, Escape |
| EmojiPicker | Arrow keys (grid), Enter, Escape |
| SearchResults | Arrow Up/Down, Enter, Escape |
| Modal | Tab trap, Escape |
| UserSettings | Arrow Up/Down (sidebar), Escape |
| ChannelList | Arrow Up/Down, Home, End |
| Sidebar | Arrow Up/Down, Home, End |
